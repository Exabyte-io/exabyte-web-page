repositories:
  - name: bndigital
    url: https://dcr.bndigital.dev/chartrepo/library

helmDefaults:
  kubeContext: do-fra1-bndigital
  createNamespace: true
  cleanupOnFail: true

environments:
  default:
    values:
      - imageRepository: dcr.bndigital.dev/exabyte
  staging:
    values:
      - imageRepository: dcr.bndigital.dev/exabyte

releases:
  - name: exabyte-website
    namespace: '{{ .Environment.Name }}'
    chart: bndigital/nodejs
    values:
      - image: '{{ .Values.imageRepository }}/website:{{ env "GITHUB_SHA" | default "latest" }}'
        imagePullSecrets: [ container-registry ]
        ingress:
          host: exabyte.bndigital.dev
          proxy:
            enabled: true
            path: /(admin|auth|import-export-content|callback|connect|content-manager|content-type-builder|email|email-designer|entity-relationship-chart|i18n|graphql|register|responsive-image|users-permissions|upload|uploads)(.*)
            backend:
              service: exabyte-cms-nodejs

  - name: exabyte-cms
    namespace: '{{ .Environment.Name }}'
    chart: bndigital/nodejs
    values:
      - image: '{{ .Values.imageRepository }}/cms:{{ env "GITHUB_SHA" | default "latest" }}'
        imagePullSecrets: [ container-registry ]
        secrets: [ backend-services ]
        configMaps: [ backend-services ]
        app:
          env:
            DATABASE_CLIENT: sqlite
